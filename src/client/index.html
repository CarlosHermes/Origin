<!DOCTYPE html>
<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>TestSocket</title>
        <!--<link rel="stylesheet" href="cssJavascript.css" type="text/css" />-->    
        <script>
            let username = document.getElementById('username');
            let password = document.getElementById('password');
            let username2 = document.getElementById('username2');
            let password2 = document.getElementById('password2');
            let field = document.getElementById('field');
            let value = document.getElementById('value');
            let password3 = document.getElementById('password3');

            var user = '';

            ////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////
            /// BASADO EN AJAXCRAFT
            function getResp(whichPage) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        var jsonDoc = this.responseText;
                        //jsonDoc = JSON.parse(jsonDoc);
                        //jsonDoc = JSON.stringify(jsonDoc);
                        document.getElementById(whichPage).innerHTML = jsonDoc;
                    }
                }
                xhttp.open("GET", "/" + whichPage, true);
                xhttp.setRequestHeader('Content-type', 'application/json');
                xhttp.send();
            }
            ////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////
            /// BASADO EN TU CODIGO
            request = new XMLHttpRequestUpload();
            function requestSend(type, url, whichId, data)
            {
                if (request) {
                    request.onload = function () {
                        var jsonDoc = this.responseText;
                        //jsonDoc = JSON.parse(jsonDoc);
                        //jsonDoc = JSON.stringify(jsonDoc);
                        document.getElementById(whichId).innerHTML = jsonDoc;
                    }
                    //request.onerror = function(){ alert(request.responseText); }
                    request.open(type, url, true);
                    request.setRequestHeader('Content-Type', 'application/json');
                    //if (data == '') data = { user: 'algo', score: 0 }
                    request.send(JSON.stringify(data));
                }
            }
            ////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////
            /// EJEMPLO DE FETCH BASADO EN STACKOVERFLOW
            /// INFO: https://davidwalsh.name/fetch // https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
            function tryFetch(method, url) {
                fetch(url, {
                    method: method,
                    body: new FormData(document.getElementById("inputform")),
                    // body : JSON.stringify({
                    // user : document.getElementById('user').value,
                    // ...
                    // })
                }).then(
                    response => response.json()
                ).then(
                    html => console.log(html)
                )
            }
            ////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////
            /// ESTE MASTODONTE SE PUEDE SIMPLIFICAR
            function clicker(action) {
                var data = '';
                var resp;
                switch(action)
                {
                    case 'server':
                        //document.getElementById("resLogin").innerText = action;
                        //resp= xmlhttprequest.send("http://localhost:3000/");
                        //resp = requesttSend('Get', 'http://localhost:3000/', null);
                        //resp = requesttSend('GET', 'localhost:3000/test', data);
                        const options = {
                            method: 'GET',
                            headers:{
                                'Content-Type': 'application/json'
                            },
                            //body: JSON.stringify(data)
                        }
                        resp = fetch('/test', options);
                        /*http.get({
                            hostname: 'localhost',
                            port: 3000,
                            path: '/'
                        }, (res) => {
                            idvar = 'asdasdasd'
                        });*/
                        //socket.emit('body')
                        //console.log(resp);
                        break;
                    case 'login':
                        //document.getElementById("resLogin").innerText = action;
                        data = {
                            "userName": username,
                            "password": password
                        }
                        resp = requesttSend('Get', 'localhost:3000/login', data);
                        //idvar = 'resLogin';
                        user = !resp.error? username: '';
                        break;
                    case 'register':
                        //document.getElementById("resLogin").innerText = action;
                        data = {
                            "password": password2
                        }
                        resp = requesttSend('Post', 'http://localhost:3000/users/:' + username2, data);
                        //idvar ='resRegister';
                        break;
                    case 'ranking':
                        //document.getElementById("resLogin").innerText = action;
                        resp = requesttSend('Get', 'http://localhost:3000/ranking', data);
                        //idvar =='resRanking';
                        break;
                    case 'myData':
                        //document.getElementById("resLogin").innerText = action;
                        resp = requesttSend('Get', 'http://localhost:3000/users/:' + user, data);
                        //idvar =='resUser';
                        break;
                    case 'update':
                        //document.getElementById("resLogin").innerText = action;
                        data = {
                            "field" : field,
                            "value" : value
                        }
                        resp = requesttSend('Put', 'http://localhost:3000/users/:' + user, data);
                        //idvar =='resUpdate';
                        break;
                    case 'delete':
                        //document.getElementById("resLogin").innerText = action;
                        data = {
                            "password" : password3
                        }
                        resp = requesttSend('Delete', 'http://localhost:3000/users/:' + user, data);
                        //idvar =='resDelete';
                        break;
                }
                idvar = action;
                document.getElementById(idvar).innerText = resp;
            }
            ////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////
        </script>
    </head>
    <body>
        <div class="general">
            <div>
                <h1>ServerStatus</h1>
                <div class="buttons">
                    <button onclick="getResp('server')">server</button>
                    <button onclick="requestSend('GET', '/server', 'server', '')">server</button>
                </div>
                <div>
                    <p id="server"></p>
                </div>
                <div>
                    ______________________
                </div>
                <h1>Login</h1>
                <div>
                    <input type="string" id="username">
                </div>
                <!--<div>
                    <p id="operacion"></p>
                </div>-->
                <div>
                    <input type="string" id="password">
                </div>
                <div class="buttons">
                    <button onclick="requestSend('GET', '/server', 'server')">login</button>
                </div>
                <div>
                    <p id="login"></p>
                </div>
                <div>
                    ______________________
                </div>
                <h1>Register</h1>

                <div>
                    <input type="string" id="username2">
                </div>
                <div>
                    <input type="string" id="password2">
                </div>
                <div class="buttons">
                    <button onclick="clicker('register')">register</button>
                </div>
                <div>
                    <p id="register"></p>
                </div>
                <div>
                    ______________________
                </div>
                <div class="buttons">
                    <button onclick="clicker('ranking')">ranking</button>
                </div>
                <div>
                    <p id="ranking"></p>
                </div>
                <div>
                    ______________________
                </div>
                <div class="buttons">
                    <button onclick="clicker('myData')">myData</button>
                </div>
                <div>
                    <p id="myData"></p>
                </div>
                <div>
                    ______________________
                </div>
                <h1>UpdateField</h1>
                <div>
                    <input type="string" id="field">
                </div>
                <div>
                    <input type="string" id="value">
                </div>
                <div class="buttons">
                    <button onclick="clicker('update')">update</button>
                </div>
                <div>
                    <p id="update"></p>
                </div>
                <div>
                    ______________________
                </div>
                <h1>DeleteUser</h1>
                <div>
                    <input type="string" id="password3">
                </div>
                <div class="buttons">
                    <button onclick="clicker('delete')">delete</button>
                </div>
                <div>
                    <p id="delete"></p>
                </div>
                <div>
                    ______________________
                </div>

            <!--</div>
            <div class="c2">
                <div class="buttons">
                    <button onclick="clicker('login')">login</button>
                </div>
                <div class="buttons">
                    <button onclick="clicker('-')">-</button>
                </div>
                <div class="buttons">
                    <button onclick="clicker('*')">*</button>
                </div>
                <div class="buttons">
                    <button onclick="clicker('/')">/</button>
                </div>
            </div>-->
        </div>
        </div>
        <!--<script src="/socket.io/socket.io.js" charset="UTF-8"></script>-->
        <!--<script src="socketTest.js" charset="UTF-8"></script>-->
    </body>
</html>